/// version = 0.1
/// title = "nNGM: nNGMv09c - FHIR to CTS"

map "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_CdsToFhir_Master" = nNGM_Mapping_CdsToFhir_Master

uses "http://hl7.org/fhir/StructureDefinition/CTS_Transport" as source
uses "http://hl7.org/fhir/StructureDefinition/Bundle" as target

// Antrag
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_StammdatenFHIR"
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_ResistenztestungFHIR"
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_TNMFHIR"

// Befund
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_FastTrackFHIR"
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_HistologieFHIR"
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_SonstigeUntersuchungenFHIR"

// Operation

group MapCDS(source src: CTS_Transport, target tgt: Bundle)
{
    // Bundle metadata
    src -> tgt.id = uuid();
    src -> tgt.type = 'collection';

    // Antrag
    src then TransformBundleStammdaten(src, tgt);
    src then TransformBundleTNM(src, tgt);
    src then TransformBundleResistenztestung(src, tgt);

    // Befund
    src then TransformBundleFastTrack(src, tgt);
    src then TransformBundleHistologie(src, tgt);
    src then TransformBundleSonstigeUntersuchungen(src, tgt);

    // Operation
}