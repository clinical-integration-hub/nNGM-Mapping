/// version = 0.1
/// title = "nNGM: nNGMv09c - FHIR to CTS"

map "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_CdsToFhir_Master" = nNGM_Mapping_CdsToFhir_Master

uses "http://hl7.org/fhir/StructureDefinition/CTS_Transport" as source
uses "http://hl7.org/fhir/StructureDefinition/Bundle" as target

// Antrag
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_StammdatenFHIR"
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_ResistenztestungFHIR"
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_TNMFHIR"
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_BasisangabenFHIR"
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_Anforderung"

// Befund
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_FastTrackFHIR"
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_HistologieFHIR"
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_SonstigeUntersuchungenFHIR"
imports "http://uk-koeln.de/fhir/StructureMap/nnGM_Mapping_BeurteilungFHIR"

// Operation
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_StrahlentherapieFHIR"
imports "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_SonstigeTherapieFHIR"

group MapCDS(source src: CTS_Transport, target tgt: Bundle)
{
    // Bundle metadata
    src -> tgt.id = uuid();
    src -> tgt.type = 'collection';

    // Antrag
    src then TransformBundleStammdaten(src, tgt);
    src then TransformBundleTNM(src, tgt);
    src then TransformBundleResistenztestung(src, tgt);
    src then TransformBundleBasisangaben(src, tgt);
    src then TransformBundleAnforderung(src, tgt);

    // Befund
    src then TransformBundleFastTrack(src, tgt);
    src then TransformBundleHistologie(src, tgt);
    src then TransformBundleSonstigeUntersuchungen(src, tgt);
    src then TransformBundleBeurteilung(src, tgt);

    // Operation
    src then TransformBundleStrahlentherapie(src, tgt);
    src then TransformBundleSonstigeTherapie(src, tgt);
}