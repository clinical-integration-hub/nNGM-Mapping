/// version = 0.1
/// title = "nNGM: nNGM_Mapping_BasisangabenCTS - FHIR to CTS"

/*
Check identifiers by system
2296
2297
id_2293 cut of day 

Coverage triggers SD map too 

*/


map "http://uk-koeln.de/fhir/StructureMap/nNGM_Mapping_BasisangabenCTS" = nNGM_Mapping_BasisangabenCTS

uses "http://hl7.org/fhir/StructureDefinition/Bundle" as source
uses "http://hl7.org/fhir/StructureDefinition/CTS_Transport" as target

group TransformBasisangebenOperation(source src: Bundle, target tgt: BackboneElement)
{
    src -> tgt.type = 'save';
    src -> tgt.crfid = 'BA';

    src.entry as entry then
    {
        entry.resource as organization where "resource is Organization and resource.meta.profile = 'http://clinicalsite.org/fhir/StructureDefinition/organizationalunit'" then 
        {
            organization -> tgt.data as data then 
            {
                organization.identifier as identifier then
                {
                    identifier.value as ival then
                    {
                        organization -> data.blockindex = 0;
                        organization -> data.groupindex = 0;
                        organization -> data.itemid = 'id_ba_siteid';
                        ival -> data.values as values, values.unit = 'count', values.value = ival;
                    };
                };
            };

            //Netzwerkpartnernr
            organization -> tgt.data as data then 
            {
                organization.address as address then
                {
                    address.text as text then
                    {
                        organization -> data.blockindex = 1;
                        organization -> data.groupindex = 0;
                        organization -> data.itemid = 'id_2326';
                        text -> data.values as values, values.value = text;
                    };
                };
            };

            //Referenzen Kontakt
            organization -> tgt.data as data then 
            {
                organization.address as address then
                {
                    address.text as text then
                    {
                        organization -> data.blockindex = 1;
                        organization -> data.groupindex = 0;
                        organization -> data.itemid = 'id_2485';
                        text -> data.values as values, values.value = text;
                    };
                };
            };

            //Netzwerkzentrum Standort
            organization -> tgt.data as data then 
            {
                organization.identifier as name then
                {
                    organization -> data.blockindex = 2;
                    organization -> data.groupindex = 0;
                    organization -> data.itemid = 'id_2435';
                    name.value as value -> data.values as values, values.value = value;
                };
            };

            //Netzwerkzentrum Kontakt
            organization -> tgt.data as data then 
            {
                organization.address as address then
                {
                    organization -> data.blockindex = 2;
                    organization -> data.groupindex = 0;
                    organization -> data.itemid = 'id_2458';
                    address.text as txt -> data.values as values, values.value = txt; 
                };
            };
        };

        /* ------------------------------ ServiceRequest ---------------------------- */

        entry.resource as servicerequest where "resource is ServiceRequest and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/ServiceRequest/nNGM/tumorboard'" then
        {   
            //Patient ID -> cts.patid
            servicerequest -> tgt.data as data then
            {
                servicerequest.subject as subject then
                {   
                    subject.reference as patient then
                    {
                        patient -> tgt.patid = evaluate(patient, '$this.split(\'\/\').last()');
                    };
                };
            };

            //Anforderungsdatum
            servicerequest -> tgt.data as data then 
            {
                servicerequest.authoredOn as authoredon where "%tgt.data.where(itemid = 'id_1571').exists().not()" then
                {
                    servicerequest -> data.blockindex = 3;
                    servicerequest -> data.groupindex = 0;
                    servicerequest -> data.itemid = 'id_1571';
                    authoredon -> data.values as values, values.value = authoredon;
                };
            };

            //Patient ist zum zeitpunkt der Anforderung 
            servicerequest -> tgt.data as data then
            {
                servicerequest.extension as aufenthaltsart, aufenthaltsart.value as value where "$this.url = 'http://uk-koeln.de/fhir/StructureDefinition/Extension/nNGM/aufenthaltsart'" then
                {
                    aufenthaltsart.valueCodeableConcept as vcc, vcc.coding as coding, coding.code as code where "code = 'IMP'" then
                    {
                        servicerequest -> data.blockindex = 3;
                        servicerequest -> data.groupindex = 0;
                        servicerequest -> data.itemid  = 'id_1576';
                        code -> data.values as values, values.value = 'stationär';
                    };
                    aufenthaltsart.valueCodeableConcept as vcc, vcc.coding as coding, coding.code as code where "code = 'AMB'" then
                    {
                        servicerequest -> data.blockindex = 3;
                        servicerequest -> data.groupindex = 0;
                        servicerequest -> data.itemid  = 'id_1576';
                        code -> data.values as values, values.value = 'ambulant';
                    };
                    aufenthaltsart.valueCodeableConcept as vcc, vcc.coding as coding, coding.code as code where "code = 'UNK'" then
                    {
                        servicerequest -> data.blockindex = 3;
                        servicerequest -> data.groupindex = 0;
                        servicerequest -> data.itemid  = 'id_1576';
                        code -> data.values as values, values.value = 'N/A';
                    };
                };
            };

            //Ich wünsche eine Vorstellung des Falls im Tumorboard des nNGM (Zentrum der Anforderung)
             servicerequest -> tgt.data as data then
            {
                servicerequest.requester as requester, requester.extension as extension where "extension.url = 'http://uk-koeln.de/fhir/StructureDefinition/Extension/nNGM/vorstellung-tmb'" then
                {
                    extension.valueBoolean as valueBoolean where "valueBoolean = true" then
                    {
                        servicerequest -> data.blockindex = 10;
                        servicerequest -> data.groupindex = 0;
                        servicerequest -> data.itemid  = 'id_2296';
                        valueBoolean -> data.values as values, values.value = 'yes';
                    };

                    extension.valueBoolean as valueBoolean where "valueBoolean = false" then
                    {
                        servicerequest -> data.blockindex = 10;
                        servicerequest -> data.groupindex = 0;
                        servicerequest -> data.itemid  = 'id_2296';
                        valueBoolean -> data.values as values, values.value = 'no';
                    };
                };
            };
            
            //Ich möchte am Tumorboard perönlich oder per Telefonkonferenz teilnehmen
            servicerequest -> tgt.data as data then
            {
                servicerequest.requester as requester, requester.extension as extension where "$this.extension.url = 'http://uk-koeln.de/fhir/StructureDefinition/Extension/nNGM/vorstellung-tmb'" then
                {
                    extension.valueBoolean where "$this.valueBoolean = true" then
                    {
                        servicerequest -> data.blockindex = 10;
                        servicerequest -> data.groupindex = 0;
                        servicerequest -> data.itemid  = 'id_2297';
                        extension.valueBoolean -> data.values as values, values.value = 'yes';
                    };

                    extension.valueBoolean where "$this.valueBoolean = false" then
                    {
                        servicerequest -> data.blockindex = 10;
                        servicerequest -> data.groupindex = 0;
                        servicerequest -> data.itemid  = 'id_2297';
                        extension.valueBoolean -> data.values as values, values.value = 'no';
                    };
                };
            };
        };
        
        
        /* ------------------------------ Practitioner ---------------------------- */


            entry.resource as practitioner where "resource is Practitioner" then 
        {   
            //Email addresse behandler
            practitioner -> tgt.data as data then 
            {
                practitioner.telecom as telecom then
                {
                    practitioner -> data.blockindex = 10;
                    practitioner -> data.groupindex = 0;
                    practitioner -> data.itemid = 'id_2298';
                    telecom.value as email -> data.values as values, values.value = email;
                };
            };
        };

        /* ------------------------------ Patient (No IDAT) ---------------------------- */


        entry.resource as patient where "resource is Patient" then
        {   
            //GENDER
            patient -> tgt.data as data then 
            {
                patient.gender as gender where "gender = 'female'" then
                {
                    patient -> data.blockindex = 4;
                    patient -> data.groupindex = 0;
                    patient -> data.itemid = 'id_1131';
                    gender -> data.values as values, values.value = 'weiblich'; 
                };
                patient.gender as gender where "gender = 'male'" then
                {
                    patient -> data.blockindex = 4;
                    patient -> data.groupindex = 0;
                    patient -> data.itemid = 'id_1131';
                    gender -> data.values as values, values.value = 'männlich'; 
                };

                patient.extension as gender where "extension.valueCodeableConcept.coding.code = 'X'" then
                {
                    patient -> data.blockindex = 4;
                    patient -> data.groupindex = 0;
                    patient -> data.itemid = 'id_1131';
                    gender -> data.values as values, values.value = 'divers'; 
                };
            };

            //Country
            patient -> tgt.data as data then 
            {
                patient.address as address, address.country as country then
                {
                    patient -> data.blockindex = 4;
                    patient -> data.groupindex = 0;
                    patient -> data.itemid = 'id_1280';
                    country -> data.values as values, values.value = country;
                };
            };
        };

        /* ------------------------------ Coverage ---------------------------- */

        entry.resource as coverage where "resource is Coverage" then
        {   
            //Type.text -> Krankenkasse
            coverage -> tgt.data as data then 
            {
                coverage.payor as payor, payor.display as display then
                {
                    coverage -> data.blockindex = 5;
                    coverage -> data.groupindex = 0;
                    coverage -> data.itemid = 'id_2459';
                    display -> data.values as values, values.value = display;
                };
            };


            //type.coding -> TYP
            coverage -> tgt.data as data then 
            {
                coverage.type as type, type.coding as coding then
                {
                    coverage -> data.blockindex = 5;
                    coverage -> data.groupindex = 0;
                    coverage -> data.itemid = 'id_1269';
                    coding.code as code -> data.values as values, values.value = code;
                };
            };

            //valueCodeableConcept.coding.code -> PKV tariff
            coverage -> tgt.data as data then 
            {
                coverage.extension as ext, ext.valueCodeableConcept as vcc, vcc.coding as coding then
                {
                    coverage -> data.blockindex = 5;
                    coverage -> data.groupindex = 0;
                    coverage -> data.itemid = 'id_1270';
                    coding.code as code -> data.values as values, values.value = code;
                };
            };

             
             coverage -> tgt.data as data then 
            {
                coverage.extension as ext, ext.valueBoolean as bool then
                {
                    coverage -> data.blockindex = 5;
                    coverage -> data.groupindex = 0;
                    coverage -> data.itemid = 'id_2460';
                    bool -> data.values as values, values.value = bool;
                };
            };

             coverage -> tgt.data as data then 
            {
                coverage.identifier as iden then
                {
                    coverage -> data.blockindex = 5;
                    coverage -> data.groupindex = 0;
                    coverage -> data.itemid = 'id_1268';
                    iden.value as value -> data.values as values, values.value = value;
                };
            };

            //payor.extension.valueCodeableConcept.coding.code -> abrechnungsinformationen
            coverage -> tgt.data as data then 
            {
                coverage.payor as payor, payor.extension as extension, extension.valueCodeableConcept as vcc, vcc.coding as coding then
                {
                    coverage -> data.blockindex = 5;
                    coverage -> data.groupindex = 0;
                    coverage -> data.itemid = 'id_1333';
                    coding.code as info -> data.values as values, values.value = info;
                };
            };
        };

        /* ------------------------------ Observation ---------------------------- */
     
        entry.resource as observation where "resource is Observation and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/nNGM/koerpergroesse'" then 
        {   
            //Height
            observation -> tgt.data as data then 
            {
                observation.valueQuantity as quantity then
                {
                    observation -> data.blockindex = 6;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid = 'id_1133';
                    quantity.code as unit -> data.values as values, values.unit = unit;
                    quantity.value as height -> data.values as values collate, values.value = height;
                };
            };
        };

        entry.resource as observation where "resource is Observation and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/nNGM/koerpergewicht'" then 
        {   

            //Weight
            observation -> tgt.data as data then 
            {
                observation.valueQuantity as quantity then
                {
                    observation -> data.blockindex = 6;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid = 'id_1132';
                    quantity.code as unit -> data.values as values, values.unit = unit;
                    quantity.value as weight -> data.values as values collate, values.value = weight;
                };
            };
        };

        entry.resource as observation where "resource is Observation and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/nNGM/ecog'" then 
        {   

            //Ecog
            observation -> tgt.data as data then 
            {
                observation.valueCodeableConcept as vcc, vcc.coding as coding then
                {
                    observation -> data.blockindex = 6;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid = 'id_2290';
                    coding.code as ecog -> data.values as values, values.value = ecog; //translate(ecog, 'http://uk-koeln.de/fhir/ConceptMap/nngm/ecogR', 'string');
                };
            };
        };

        entry.resource as observation where "resource is Observation and resource.meta.profile = 'http://uk-koeln.de/fhir/StructureDefinition/Observation/nNGM/raucherstatus'" then 
        {   
            //Raucherstatus
            observation -> tgt.data as data then 
            {
                observation.valueCodeableConcept as vcc, vcc.coding as coding where "coding.code = 'LA18979-7'" then
                {
                    observation -> data.blockindex = 7;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid = 'id_2292';
                    coding.code -> data.values as values, values.value = 'Raucher';
                };

                observation.valueCodeableConcept as vcc, vcc.coding as coding where "coding.code = 'LA15920-4'" then
                {
                    observation -> data.blockindex = 7;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid = 'id_2292';
                    coding.code -> data.values as values, values.value = 'Ex-Raucher';
                };

                observation.valueCodeableConcept as vcc, vcc.coding as coding where "coding.code = 'LA18978-9'" then
                {
                    observation -> data.blockindex = 7;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid = 'id_2292';
                    coding.code -> data.values as values, values.value = 'Nieraucher';
                };

                observation.valueCodeableConcept as vcc, vcc.coding as coding where "coding.code = 'LA18980-5'" then
                {
                    observation -> data.blockindex = 7;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid = 'id_2292';
                    coding.code -> data.values as values, values.value = 'N/A';
                };
            };

            //Nichtraucher seit 
            observation -> tgt.data as data then 
            {
                observation.component as component, component.code as code where "code.coding.code = '63630-8'" then
                {
                    observation -> data.blockindex = 7;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid = 'id_2293';
                    component.valueDateTime as vdt -> data.values as values, values.value = vdt; 
                };               
            };
            
            //Pack years
            observation -> tgt.data as data then 
            {
                observation.component as component, component.valueQuantity as valueQuantity where "valueQuantity.code = '{PackYears}'" then
                {                    
                    observation -> data.blockindex = 7;
                    observation -> data.groupindex = 0;
                    observation -> data.itemid = 'id_2294';
                    component.valueQuantity as vq, vq.value as value -> data.values as values, values.unit = 'count',  values.value = value;   
                };
            };
        };
        
        /* ------------------------------ Consent ---------------------------- */

        entry.resource as consent where "resource is Consent" then 
        {   
            //1a Signed
            consent -> tgt.data as data then 
            {
                consent.policyRule as policyRule where "policyRule.coding.code = '1a'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                        consent -> data.blockindex = 8;
                        consent -> data.groupindex = 0;
                        consent -> data.itemid = 'id_2440';
                        consent -> data.values as values, values.value = 'yes';
                    };

                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                        consent -> data.blockindex = 8;
                        consent -> data.groupindex = 0;
                        consent -> data.itemid = 'id_2440';
                        consent -> data.values as values, values.value = 'no';
                    };
                };
            };

            consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = '1a' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 8;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2441';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            };         

            //1b Signed
            consent -> tgt.data as data then 
            {
                consent.policyRule as policyRule where "policyRule.coding.code = '1b'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                    consent -> data.blockindex = 8;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2446';
                    provision.type -> data.values as values, values.value = 'yes';
                    };
                };

                consent.policyRule as policyRule where "policyRule.coding.code = '1b'" then
                {
                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                    consent -> data.blockindex = 8;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2446';
                    provision.type -> data.values as values, values.value = 'no';
                    };
                };
            };

            consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = '1b' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 8;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2447';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            };  

            //2 Signed
            consent -> tgt.data as data then 
            {
                consent.policyRule as policyRule where "policyRule.coding.code = '2'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                    consent -> data.blockindex = 8;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2449';
                    provision.type -> data.values as values, values.value = 'yes';
                    };
                };

                consent.policyRule as policyRule where "policyRule.coding.code = '2'" then
                {
                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                    consent -> data.blockindex = 8;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2449';
                    provision.type -> data.values as values, values.value = 'yes';
                    };
                };
            };

            consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = '2' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 8;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2450';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            };  

            //Teilnahme erklarung
            consent -> tgt.data as data then 
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'TE'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                    consent -> data.blockindex = 9;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2392';
                    provision.type -> data.values as values, values.value = 'yes';
                    };
                };

                consent.policyRule as policyRule where "policyRule.coding.code = 'TE'" then
                {
                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                    consent -> data.blockindex = 9;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2392';
                    provision.type -> data.values as values, values.value = 'no';
                    };
                };
            };

            consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'TE' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 9;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2393';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            };  


            //Datenschutz
            consent -> tgt.data as data then 
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'DS'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                    consent -> data.blockindex = 9;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2389';
                    provision.type -> data.values as values, values.value = 'yes';
                    };
                };

                consent.policyRule as policyRule where "policyRule.coding.code = 'DS'" then
                {
                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                    consent -> data.blockindex = 9;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2389';
                    provision.type -> data.values as values, values.value = 'no';
                    };
                };
            };

            consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'DS' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 9;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2390';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            };  

            /* -------------------Versorgung------------------------*/

            //Molpatho diagnostik signed 
            consent -> tgt.data as data then 
            {
               consent.policyRule as policyRule where "policyRule.coding.code = 'MD'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2351';
                    provision.type -> data.values as values, values.value = 'yes';
                    };
                };
                
                consent.policyRule as policyRule where "policyRule.coding.code = 'MD'" then
                {
                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2351';
                    provision.type -> data.values as values, values.value = 'no';
                    };
                };
            };

            consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'MD' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2352';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            }; 

            //Uberregionale Beratung
            consent -> tgt.data as data then 
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'ST'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2357';
                    provision.type -> data.values as values, values.value = 'yes';
                    };
                };

                consent.policyRule as policyRule where "policyRule.coding.code = 'ST'" then
                {
                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2357';
                    provision.type -> data.values as values, values.value = 'no';
                    };
                };
            };

            consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'ST' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2358';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            }; 

             /* -------------------ForschungsZwecke 1------------------------*/

            consent -> tgt.data as data then 
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'WPI'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2361';
                    provision.type -> data.values as values, values.value = 'yes';
                    };
                };

                consent.policyRule as policyRule where "policyRule.coding.code = 'WPI'" then
                {
                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2361';
                    provision.type -> data.values as values, values.value = 'no';
                    };
                };
            };

            consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'WPI' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2362';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            }; 

            /*-----------------------2------------------------*/
            consent -> tgt.data as data then 
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'WP'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2364';
                    provision.type -> data.values as values, values.value = 'yes';
                    };
                };

                consent.policyRule as policyRule where "policyRule.coding.code = 'WP'" then
                {
                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2364';
                    provision.type -> data.values as values, values.value = 'no';
                    };
                };
            };

            consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'WP' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2365';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            }; 


            /*--------------------3---------------------------*/
            consent -> tgt.data as data then 
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'WD'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2367';
                    provision.type -> data.values as values, values.value = 'yes';
                };
                };

                consent.policyRule as policyRule where "policyRule.coding.code = 'WD'" then
                {
                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2367';
                    provision.type -> data.values as values, values.value = 'no';
                };
                };
            };

             consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'WD' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2368';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            }; 
            
            /*------------------------4-----------------------*/
            consent -> tgt.data as data then 
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'WR'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2370';
                    provision.type -> data.values as values, values.value = 'yes';
                    };
                };

                consent.policyRule as policyRule where "policyRule.coding.code = 'WR'" then
                {
                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2370';
                    provision.type -> data.values as values, values.value = 'no';
                    };
                };
            };

            consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'WR' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2371';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            }; 

            /*---------------------5--------------------------*/
            consent -> tgt.data as data then 
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'WPK'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2373';
                    provision.type -> data.values as values, values.value = 'yes';
                    };
                };

                consent.policyRule as policyRule where "policyRule.coding.code = 'WPK'" then
                {
                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2373';
                    provision.type -> data.values as values, values.value = 'no';
                    };
                };
            };

            consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'WPK' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2374';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            }; 

            /*----------------------6-------------------------*/
            consent -> tgt.data as data then 
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'WK'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2376';
                    provision.type -> data.values as values, values.value = 'yes';
                    };
                };

                consent.policyRule as policyRule where "policyRule.coding.code = 'WK'" then
                {
                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2376';
                    provision.type -> data.values as values, values.value = 'no';
                    };
                };
            };

            consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'WK' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2377';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            }; 

            /*----------------------7-------------------------*/
            consent -> tgt.data as data then 
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'KW'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2382';
                    provision.type -> data.values as values, values.value = 'yes';
                    };
                };

                consent.policyRule as policyRule where "policyRule.coding.code = 'KW'" then
                {
                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2382';
                    provision.type -> data.values as values, values.value = 'no';
                    };
                };
            };

            consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'KW' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2383';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            }; 

            /*------------------------8-----------------------*/
            consent -> tgt.data as data then 
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'KE'" then
                {
                    consent.provision as provision where "provision.type = 'permit'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2379';
                    provision.type -> data.values as values, values.value = 'yes';
                    };
                };

                consent.policyRule as policyRule where "policyRule.coding.code = 'KE'" then
                {
                    consent.provision as provision where "provision.type = 'deny'" then
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2379';
                    provision.type -> data.values as values, values.value = 'no';
                    };
                };
            };

            consent -> tgt.data as data then
            {
                consent.policyRule as policyRule where "policyRule.coding.code = 'KE' and provision.type = 'permit'" then
                {
                    consent.dateTime as dt then 
                    {
                    consent -> data.blockindex = 11;
                    consent -> data.groupindex = 0;
                    consent -> data.itemid = 'id_2380';
                    dt -> data.values as values, values.value = dt;
                    };
                };
            }; 
        };
    };
}